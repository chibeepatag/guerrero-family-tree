<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@10.2.7/dist/autoComplete.min.js"></script>
    <script>
        function createAutocomplete(field){
            const autocomplete = new autoComplete({
                name: field,
                selector: `#${field}`,
                wrapper: false,
                placeHolder: "Search for member...",
                data: {
                    src: async (query) => {
                      try {
                        const source = await fetch(`search?name=${query}`);
                        const data = await source.json();
                        return data;
                      } catch (error) {
                        return error;
                      }
                    },
                    keys: ["name"]
                },
                resultItem: {
                    highlight: true
                },
                events: {
                    input: {
                        selection: (event) => {
                            const selection = event.detail.selection.value;
                            autocomplete.input.value = selection.name;
                            autocomplete.input.parentNode.querySelector(`#${autocomplete.input.dataset.field}`).value = selection.id
                        }
                    }
                }
            });
        }
        function createAllAutocomplete(){
            createAutocomplete('spouse_auto');
            createAutocomplete('father_auto');
            createAutocomplete('mother_auto');       
        }
        document.addEventListener('DOMContentLoaded', createAllAutocomplete, false);
    </script>
</head>
<body>
  <h1>Editing member</h1>
    <%= form_with(model: @member) do |form| %>
      <% if @member.errors.any? %>
        <div style="color: red">
          <h2><%= pluralize(member.errors.count, "error") %> prohibited this member from being saved:</h2>

          <ul>
            <% @member.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <%= form.label :branch, "Branch:" %>
      <%= select(:member, :branch, options_for_select([['Luis', 'Luis'], ['Alfredo', 'Alfredo'], ['Jose', 'Jose'], ['Fernando', 'Fernando'], ['Manuel', 'Manuel'], ['Rosa', 'Rosa']])) %><br/>
      <%= form.label :name, "Name:" %>
      <%= form.text_field :name %> <br/>
      <%= form.label :nicknames, "Nicknames:" %>
      <%= form.text_field :nicknames %> <br/>
      <%= form.label :birth, "Birth:" %>
      <%= form.number_field :birth %> <br/>
      <%= form.label :death, "Death:" %>
      <%= form.number_field :death %> <br/>
      Spouse 1: <input type="hidden" id="spouse1" class="id_field" name="member[spouse_id]"/>
      <input id="spouse_auto" type="search" dir="ltr" spellcheck=false autocorrect="off" autocomplete="off" autocapitalize="off" data-field="spouse1"/><br/>
      <%= form.label :father_id, "Father:"%>
      <input type="hidden" id="father" class="id_field" name="member[father_id]"/>
      <input id="father_auto" type="search" dir="ltr" spellcheck=false autocorrect="off" autocomplete="off" autocapitalize="off" data-field="father"/><br/>
      <%= form.label :mother_id, "Mother:"%>
      <input type="hidden" id="mother" class="id_field" name="member[mother_id]"/>
      <input id="mother_auto" type="search" dir="ltr" spellcheck=false autocorrect="off" autocomplete="off" autocapitalize="off" data-field="mother"/><br/>
       <br/>
      <div>
        <%= form.submit %>
      </div>
    <% end %>
    <br>
<div>
  <%= link_to "Show this member", @member %> |
  <%= link_to "Back to members", members_path %> | 
  <%= button_to "Destroy this member", @member, method: :delete %>
</div>
</body>
</html>





